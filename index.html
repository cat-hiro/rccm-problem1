<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>暗記レベルドリル</title>
<style>
    :root{
      --bg:#f6faf9;
      --primary:#0ea5e9; /* blue */
      --accent:#10b981;  /* green */
      --text:#0f172a;
      --muted:#64748b;
      --card:#ffffff;
      --ok:#16a34a;
      --ng:#ef4444;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,"Noto Sans JP","Hiragino Kaku Gothic ProN","Yu Gothic",Meiryo,sans-serif;
      background: linear-gradient(135deg, rgba(14,165,233,.10), rgba(16,185,129,.10)) fixed, var(--bg);
      color: var(--text);
    }
    .container{max-width:892px;margin:0 auto;padding:16px 14px 120px}
    header{
      position:sticky; top:0; z-index:5;
      backdrop-filter: blur(8px);
      background: linear-gradient(90deg, rgba(14,165,233,.9), rgba(16,185,129,.9));
      color:#fff; padding:14px 16px; display:flex; align-items:center; gap:10px;
      box-shadow: 0 2px 12px rgba(0,0,0,.15);
    }
    header h1{font-size:18px;margin:0; font-weight:700; letter-spacing:.02em}
    .btn{
      appearance:none; border:none; border-radius:14px; padding:14px 16px; font-weight:700;
      background: linear-gradient(135deg, var(--primary), var(--accent));
      color:#fff; box-shadow: 0 8px 20px rgba(16,185,129,.2);
      cursor:pointer; transition: transform .02s ease, filter .2s;
    }
    .btn:active{ transform: translateY(1px) }
    .btn.secondary{
      background:#fff;color:var(--text); border:1px solid rgba(15,23,42,.08);
      box-shadow: 0 4px 10px rgba(2,6,23,.08);
    }
    .btn.ghost{background:transparent;color:#fff;border:1px solid rgba(255,255,255,.5)}
    .grid{display:grid; gap:12px}
    .themes{grid-template-columns: repeat(1, minmax(0,1fr))}
    @media(min-width:520px){ .themes{grid-template-columns: repeat(2, minmax(0,1fr))} }
    @media(min-width:840px){ .themes{grid-template-columns: repeat(3, minmax(0,1fr))} }
    .card{
      background: var(--card);
      border:1px solid rgba(15,23,42,.06);
      border-radius:20px; padding:16px; display:flex; flex-direction:column; gap:8px;
      box-shadow: 0 6px 18px rgba(2,6,23,.06);
    }
    .card .title{font-weight:800; line-height:1.3}
    .badge{
      display:inline-flex; align-items:center; gap:8px;
      background:linear-gradient(135deg, rgba(14,165,233,.15), rgba(16,185,129,.15));
      color:#0f766e; padding:6px 10px; border-radius:999px; font-weight:700; font-size:12px;
    }
    .subgrid{display:grid; grid-template-columns: repeat(2,minmax(0,1fr)); gap:10px}
    .itembtn{padding:12px; border-radius:14px; border:1px solid rgba(15,23,42,.06); background:#fff; text-align:left; font-weight:700; cursor:pointer}
    .itembtn small{display:block; font-weight:600; color:var(--muted)}
    .levelbar{display:flex; gap:6px; align-items:center}
    .dot{width:12px;height:12px;border-radius:50%;background:rgba(2,6,23,.15)}
    .dot.active{background:linear-gradient(135deg, var(--primary), var(--accent))}
    .pill{
      display:inline-flex; align-items:center; gap:6px; background:rgba(15,23,42,.06);
      padding:6px 10px; border-radius:999px; font-weight:700; color:var(--muted); font-size:12px;
    }
    .hint{
      white-space:pre-wrap; background:#fff; border:1px dashed rgba(15,23,42,.12);
      padding:12px; border-radius:14px; line-height:1.8; font-size:16px;
    }
    textarea{
      width:100%; min-height:160px; padding:12px; border-radius:14px;
      border:1px solid rgba(15,23,42,.12); font-size:16px; line-height:1.8; outline:none;
    }
    .foot{
      position:fixed; left:0; right:0; bottom:0; z-index:10; padding:12px 14px;
      background:linear-gradient(0deg, rgba(246,250,249,1), rgba(246,250,249,.75));
      border-top:1px solid rgba(15,23,42,.06);
    }
    .row{display:flex; gap:10px; flex-wrap:wrap}
    .grow{flex:1}
    .result{font-weight:800}
    .ok{color:var(--ok)}
    .ng{color:var(--ng)}
    .toolbar{display:flex; align-items:center; gap:8px; flex-wrap:wrap}
    .back{margin-right:auto}
    .kbd{
      background:#0b5; color:#fff; font-weight:800; padding:2px 8px; border-radius:6px; font-size:12px;
    }
    </style>
</head>
<body>
<header><h1>暗記レベルドリル</h1></header>
<main id="root"></main>
<div class="foot"></div>
<script id="app-data" type="application/json">{"1": {"title": "カーボンニュートラルに関する目標達成までの道筋", "subs": {"①": {"title": "カーボンニュートラルの現状と課題", "items": [{"num": 1, "title": "気候変動対策の加速化への道筋", "text": "現在、「地球温暖化」による気候変動は世界的な喫緊の問題となっており、政府は2050年までにカーボンニュートラルを実現することを宣言している。その一環として、政府は「グリーン成長戦略」を策定し、14の重点分野において産業政策と環境政策を統合して推進している。しかし、現状では温室効果ガスの削減ペースが目標水準を下回っている。このため、エネルギー転換、産業構造の変革、ライフスタイルの変化を同時に進めることが課題である。"}, {"num": 2, "title": "持続可能なエネルギー基盤の構築", "text": "「再生可能エネルギー」の導入拡大は着実に進んでいるものの、電力供給の安定性確保や系統制約の問題がある。現在の「再生可能エネルギー」比率は約20％であり、2030年度の36～38％目標達成には大幅な加速が必要である。「グリーントランスフォーメーション政策(GX)」として、官民で150兆円規模の投資が計画されている。このため、技術開発と制度改革、インフラ整備を一体的に進め、「脱炭素」とエネルギー安全保障を両立することが課題である。"}, {"num": 3, "title": "社会全体での「脱炭素」化の推進", "text": "産業界においては製造プロセスの見直しや省エネルギー技術の導入が進められているが、中小企業への技術の普及や初期投資の負担といった問題がある。また、国民の意識改革と行動変容を促す教育・啓発活動も不十分である。このため、「脱炭素」型ライフスタイルへの転換支援制度と、地域特性を活かした分散型エネルギーシステムの構築により、地域循環共生圏を形成することが課題である。"}]}, "②": {"title": "カーボンニュートラルの目標達成に向けた建設コンサルタントの役割", "items": [{"num": 1, "title": "持続可能な社会基盤の設計・提案", "text": "建設コンサルタントは「グリーン社会」の実現に向けて、環境負荷を最小限に抑えた社会基盤の設計・提案において、中核的な役割を担っている。「再生可能エネルギー」施設の立地選定や系統連系の技術的検討、スマートシティの都市計画、グリーンインフラの導入提案などを通じて、「脱炭素」型の地域づくりに貢献していく必要がある。また、既存インフラの長寿命化や効率化により、建設・維持管理段階でのCO2排出削減を実現することが求められている。"}, {"num": 2, "title": "環境配慮型建設技術の推進", "text": "建設コンサルタントは「低炭素建設資材」の選定や活用方法の提案を通じて、建設プロジェクト全体の環境負荷削減に貢献している。「ライフサイクルアセスメント」の手法を用いて、建設資材の製造から廃棄までの全工程における環境影響を定量的に評価し、最適な材料選択や工法の提案を行うことが重要である。リサイクル材料の活用促進、建設廃棄物の削減、施工時の省エネルギー化などを総合的に検討し、建設業界全体の「脱炭素」化をリードしていく必要がある。"}, {"num": 3, "title": "技術革新と政策提言", "text": "建設コンサルタントは技術的専門知識を活かし、カーボンニュートラルの実現に向けた新技術の開発・実用化や政策提言において重要な役割を果たすべきである。気候変動の適応策と緩和策を統合したソリューションの提供、地域特性を踏まえた「脱炭素」シナリオの策定、産学官連携による技術開発の推進などを通じて、社会全体の持続可能な発展に貢献することが期待されている。"}]}}}, "2": {"title": "国際競争力の強化", "subs": {"①": {"title": "我が国の建設コンサルタントの国際競争の現状と課題", "items": [{"num": 1, "title": "グローバル市場での競争環境", "text": "我が国の建設コンサルタントは、アジア・アフリカを中心とした新興国市場で一定の存在感を示しているが、欧米系大手コンサルタントとの競争が激化している。急速に都市化が進む途上国では、総合的な都市開発プロジェクトの需要が高まっている一方、日本企業の受注規模は限定的である。現状では、技術力は高く評価されているものの、プロジェクトマネジメント能力や提案力において不足が見られる。このため、大型案件での競争力向上が課題である。"}, {"num": 2, "title": "技術標準化への対応不足", "text": "日本の建設コンサルタントが海外展開する際の大きな障壁として、「国際標準」への対応不足が挙げられる。国内で培った高度な技術や品質管理手法は優れているものの、各国の法規制や設計基準、環境基準への適応に時間とコストを要している。ISO規格やIFC基準などの「国際標準」に準拠した業務プロセスの構築が不十分である。このため、グローバル企業としての信頼性確保と、現地条件に適した技術の現地化が課題である。"}, {"num": 3, "title": "人材とネットワークの制約", "text": "海外プロジェクトを円滑に遂行するために必要な、国際的な人材が不足しており、深刻な状況にある。特に、語学力、異文化コミュニケーション能力、現地法規制への理解を兼ね備えた人材が不足している。また、現地政府機関や民間企業とのネットワーク構築も不十分である。そのため、「人材育成」の推進と情報収集力や営業力の強化が課題である。"}]}, "②": {"title": "我が国の建設コンサルタントの国際競争への参入に向けた取り組み", "items": [{"num": 1, "title": "政府支援制度の活用と連携強化", "text": "「ODA」や円借款を活用したインフラ開発プロジェクトへの参画は、日本の建設コンサルタントにとって重要な海外展開の機会となっている。政府は「官民連携」を推進し、JICA、JETRO、NEXIなどの支援機関を通じて、案件形成から資金調達まで一貫したサポート体制を構築している。また、相手国政府との政策対話や技術協力を通じて、日本の技術や設計思想の普及を図り、受注機会の拡大に努めている。"}, {"num": 2, "title": "災害対策技術の優位性活用", "text": "日本が世界に誇る「防災」技術や災害復旧ノウハウは、自然災害リスクの高い地域で高く評価されている。地震、津波、台風などの災害対策技術、早期警戒システム、災害に強いインフラ設計などの分野において、日本の建設コンサルタントは独自の競争優位性を有している。これらの専門技術を活かし、気候変動による災害リスクが増大する世界各地でレジリエントなインフラ構築に貢献し、新たな市場開拓を進めている。"}, {"num": 3, "title": "戦略的な海外展開の推進", "text": "「インフラ輸出」戦略の一環として、建設コンサルタントは、技術移転や現地人材の育成を通じて、持続可能な事業展開を図っている。単発的なプロジェクト受注から、長期的なパートナーシップに基づく継続的な関係構築へと戦略の転換が進められている。また、デジタル技術やAI、IoTを活用したスマートインフラの提案により、従来の土木技術に加えて付加価値の高いサービスの提供にも取り組んでいる。"}]}}}, "3": {"title": "維持管理と長寿命化", "subs": {"①": {"title": "社会インフラの維持管理の現状と課題", "items": [{"num": 1, "title": "インフラの急速な劣化と財政制約", "text": "我が国の社会インフラは、高度経済成長期に集中的に整備された結果、現在では「老朽化」が急速に進行している。建設から50年以上が経過した道路橋やトンネル、上下水道施設の数が増加し、今後20年間でさらに拡大する見込みである。一方で、国や「地方公共団体」の財政状況は依然として厳しく、必要な維持管理費用の確保が困難である。特に人口減少が進む地方部では、税収減少と維持管理費の増加が同時に進行しており、インフラの安全性を確保するための取り組みが課題である。"}, {"num": 2, "title": "維持管理体制の不備と技術力不足", "text": "多くの自治体では、インフラの点検や劣化診断、補修工法の選定に対応できる専門職員が不足しており、適切な維持管理体制が整っていない。維持管理に関するデータの蓄積や分析も進まず、効率的な維持管理計画の策定が困難な状況である。また、施設ごとに所管部署が異なるケースが多く、横断的・総合的な戦略の構築も進んでいない。このような現状から、体制整備と技術力の向上が課題である。"}, {"num": 3, "title": "コスト管理と優先順位付けの困難", "text": "限られた財源の中で持続的な維持管理を実現するためには、「ライフサイクルコスト」の考え方に基づいた長期的な視点が不可欠である。しかし、多くの自治体では依然として事後保全型の対応が中心で、コストの最適化が十分に図られていない。膨大なインフラ施設の中から、緊急性や重要性に応じた優先順位を適切に設定することが難しく、住民生活や経済活動への影響を考慮した評価手法の整備が課題である。"}]}, "②": {"title": "社会インフラの長寿命化のあり方について", "items": [{"num": 1, "title": "予防保全型維持管理への転換", "text": "従来の事後保全中心の対応から、「予防的処置」を重視した維持管理への転換が急務である。定期的な点検・診断を通じて劣化の兆候を早期に把握し、適切なタイミングで補修・補強を行うことで、施設の機能を長期にわたり維持することが可能となる。これにより、大規模修繕の頻度やコストを抑制し、使用停止による社会的影響の軽減にもつながる。"}, {"num": 2, "title": "技術革新による効率化の推進", "text": "「新技術」の導入は、維持管理の効率化と高度化に大きく貢献する。AIやドローンを活用した点検の自動化、IoTセンサーによるリアルタイム監視、ビッグデータを用いた劣化予測などが代表例である。さらに、新材料や新工法を導入することで、インフラの耐久性向上や補修作業の合理化が可能となる。これらの技術を積極的に取り入れ、持続可能な維持管理体制を確立することが求められる。"}, {"num": 3, "title": "戦略的な「更新」と機能向上", "text": "施設の「更新」にあたっては、単なる原状復旧にとどまらず、将来の社会ニーズや環境変化を見据えた機能向上が求められる。人口減少や高齢化、気候変動、デジタル化の進展に対応し、必要な機能の見直しや施設統廃合を検討することが重要である。また、最新の技術基準や環境基準への適合を図り、地域特性に応じた柔軟な整備手法を取り入れ、効果的かつ持続可能な「更新」を推進する必要がある。"}]}}}, "4": {"title": "工程管理と働き方改革", "subs": {"①": {"title": "建設コンサルタントの工程管理の現状と課題", "items": [{"num": 1, "title": "工程管理手法の精度向上", "text": "建設コンサルタント業務における工程管理は、複雑で専門性の高い業務特性により、困難を伴うことが多い。現状では「工程表」の作成段階で、業務の詳細な作業内容や所要時間の見積もりが不十分であり、実際の進捗との乖離が生じやすい。設計業務や調査業務では、現地条件の変化や関係機関との協議により作業量が大きく変動するため、当初計画の修正が頻繁に発生している。さらに、複数の専門分野が関わる大規模プロジェクトでは、各分野間の連携や依存関係の把握が不十分である。このため、工程計画の精度向上と全体最適化の実現が課題である。"}, {"num": 2, "title": "「履行期間」の適正化", "text": "発注者から設定される「履行期間」が業務内容に対して過度に短い場合が多く、適切な工程管理を困難にしている。短期間での業務完了を求められることで、十分な検討時間を確保できず、業務品質の低下や手戻り作業が発生している。「履行期間」の制約により、必要な現地調査や関係機関との協議が不十分となり、後工程に悪影響を及ぼしている。このため、適正な「履行期間」の設定と効率的な工程管理手法の確立が課題である。"}, {"num": 3, "title": "「情報共有」システムの構築", "text": "プロジェクト関係者間での「情報共有」が不十分な状況にある。発注者、設計者、施工者、関係機関などのステークホルダー間で、進捗状況や課題、変更事項などが適切に共有されておらず、その結果、工程の遅延や手戻りが発生している。また、社内においても、異なる専門分野間での「情報共有」が十分とはいえない。このため、リアルタイムで進捗を管理できる「情報共有」システムの構築が課題である。"}]}, "②": {"title": "建設コンサルタントの働き方改革と工程管理のあり方", "items": [{"num": 1, "title": "「長時間労働」の是正と効率的な業務運営", "text": "建設コンサルタント業界では「長時間労働」が常態化しており、働き方改革が急務である。適切な工程管理により業務の平準化を図り、特定の時期や個人への業務集中を避けることで、労働時間の短縮を実現する必要がある。さらに、業務の標準化や効率化を進め、同じ成果をより短時間で達成できる体制を構築することが重要である。"}, {"num": 2, "title": "「生産性向上」と業務プロセスの改善", "text": "「生産性向上」を実現するためには、従来の業務プロセスを見直し、効率的な工程管理手法を導入することが重要である。デジタル技術を活用した工程管理システムの導入により、リアルタイムでの進捗把握と迅速な意思決定を可能とする体制の構築が求められる。過去のプロジェクトデータを活用した工程計画の精度向上や、標準的な業務手順の確立により、計画的で効率的な業務遂行を実現できる。"}, {"num": 3, "title": "「ワークライフバランス(WLB)」の実現", "text": "「ワークライフバランス(WLB)」の実現には、計画的な工程管理と柔軟な働き方の両立が不可欠である。「ワークライフバランス(WLB)」の考え方を取り入れ、週単位での業務計画と進捗管理を徹底することで、計画的な業務遂行と適切な休暇取得を両立できる。テレワークやフレックスタイム制度を活用することで、個人のライフスタイルに応じた柔軟な働き方を実現しつつ、プロジェクト全体の工程管理を適切に行う体制の構築が重要である。"}]}}}, "5": {"title": "建設コンサルタントにおける人材育成", "subs": {"①": {"title": "建設コンサルタントの人材育成の現状と課題", "items": [{"num": 1, "title": "人材確保の困難と業界の魅力向上", "text": "建設コンサルタント業界では、少子高齢化と他業界との人材獲得競争により、「担い手確保」が困難な状況にある。理工系学生の就職先として、IT業界や製造業と比較して認知度や魅力度が低く、優秀な人材の確保が進んでいない。さらに、業界全体のイメージが古く、働き方や将来性に対する学生の理解が不足している。地方企業では都市部企業との待遇格差も存在している。このため、業界の魅力向上と認知度の拡大が課題である。"}, {"num": 2, "title": "若手技術者の早期離職と定着率向上", "text": "入社後の「若手技術者の育成」において、期待と現実のギャップによる早期離職が発生している。新入社員は高度な専門知識と実務経験を同時に習得する必要があるが、適切な指導体制や段階的な育成プログラムが整備されていない企業が多い。さらに、繁忙期の長時間労働や責任の重い業務への早期投入により、若手技術者が過度なストレスを感じている。このため、成長実感を得られる環境づくりと適切なキャリアパスの提示が課題である。"}, {"num": 3, "title": "体系的な育成システムの不備", "text": "多くの企業では人材育成が属人的で場当たり的な対応となっている。「研修制度」が不十分であり、技術力向上のための継続的な学習機会が限られている。さらに、中小企業では人材育成に割ける時間や予算が限られており、「オン・ザ・ジョブ・トレーニング(OJT)」中心の育成に依存している状況にある。このため、体系的な育成システムの構築と継続的な学習機会の確保が課題である。"}]}, "②": {"title": "建設コンサルタントの今後の人材育成のあり方", "items": [{"num": 1, "title": "実践的な育成プログラムの構築", "text": "効果的な人材育成には、「オン・ザ・ジョブ・トレーニング(OJT)」と体系的な研修を組み合わせた実践的な育成プログラムの構築が重要である。実際のプロジェクトを通じて技術力と実務能力を同時に向上させるとともに、定期的な研修により理論的な知識の補強を図る必要がある。さらに、段階的なスキルアップを可能とするキャリアラダーの設定により、技術者が成長を実感できる環境を整備することが求められる。"}, {"num": 2, "title": "多様性を活かした組織づくり", "text": "「多様な人材」の活用により、組織全体の創造性と問題解決能力の向上を高めることが重要である。女性技術者、外国人技術者、中途採用者など、異なる背景を持つ人材がそれぞれの強みを発揮できる環境づくりが求められる。働き方の多様化に対応し、個人のライフスタイルに応じた柔軟な勤務形態を提供することで、優秀な人材の確保と定着を実現する必要がある。"}, {"num": 3, "title": "持続可能な働き方と生産性の両立", "text": "「生産性向上」と「ワークライフバランス(WLB)」の両立により、魅力的な職場環境を整備することが人材育成の基盤となる。デジタル技術の活用による業務効率化や標準化された業務プロセスの導入により、同じ成果をより短時間で達成できる体制を構築する必要がある。また、「建設コンサルタントの役割」が社会インフラの持続的な発展に不可欠であることを明確に示し、技術者としての誇りと使命感を醸成することで、長期的なキャリア形成への意欲を高めることが求められる。"}]}}}, "6": {"title": "ICT,IoT,AI技術の利活用", "subs": {"①": {"title": "我が国における建設生産性向上のためのICT利活用の現状と課題", "items": [{"num": 1, "title": "建設現場でのICT導入の進展と限界", "text": "建設業界では、i-Constructionの推進により、測量・設計・施工・検査の各段階でICT技術の導入が進んでいる。ドローンによる3次元測量や情報化施工機械の活用により、作業効率の向上と品質の安定化が図られている。また、「BIM/CIM」の導入により、設計から施工、維持管理まで一貫したデータ活用が可能となりつつある。しかし、中小企業における導入率は依然として低く、初期投資コストや技術者不足が障壁となっている。このため、中小企業への技術普及と人材育成の推進が課題である。"}, {"num": 2, "title": "「働き方改革」とデジタル化の推進", "text": "建設業界では「長時間労働」が常態化しており、「働き方改革」の実現が急務となっている。ICT技術の活用により業務効率化を図り、労働時間の短縮を目指す取り組みが進められている。また、「緊急事態宣言」下では、「テレワーク」や「Web会議」の導入が急速に進み、従来の働き方の見直しが加速した。しかし、現場作業が中心の建設業では完全な「テレワーク」化は困難である。このため、建設業の特性に応じた柔軟な働き方を実現することが課題である。"}, {"num": 3, "title": "ICT基盤整備と技術者育成の遅れ", "text": "建設現場における「ネットワーク環境」の整備は進んでいるものの、地方や山間部では通信インフラが不十分である。さらに、ICT技術を効果的に活用できる技術者が不足しており、中高年層におけるデジタルスキルの習得も遅れている。加えて、企業間でのデータ連携や標準化が不十分であり、情報の分断が生産性向上の阻害要因となっている。このため、ICT基盤の充実と人材育成プログラムの確立が課題である。"}]}, "②": {"title": "我が国の建設業、建設コンサルタント業におけるICT、IoT、AI技術の活用方策", "items": [{"num": 1, "title": "統合的なデジタルプラットフォームの構築", "text": "建設プロジェクト全体の情報一元管理と共有を実現するためには、「BIM/CIM」を基盤とした統合的なデジタルプラットフォームの構築が重要である。設計段階から施工、維持管理まで一貫したデータ活用を行うことで、品質向上とコスト削減が可能となる。さらに、AI技術を活用した設計最適化や施工計画の自動生成により、技術者の負担軽減と生産性向上を実現できる。"}, {"num": 2, "title": "自動化技術と「RPA」の導入推進", "text": "建設現場の作業自動化を推進するためには、IoT技術を活用した建設機械の遠隔操作や自動運転技術の導入を進める必要がある。事務作業では「RPA」の導入により、定型的な業務を自動化し、技術者がより創造的な業務に集中できる環境を整備することが重要である。さらに、AI技術を活用した品質管理や安全管理システムの導入により、人的ミスの削減と作業効率の向上を実現できる。"}, {"num": 3, "title": "人材育成とデジタル変革の推進", "text": "ICT、IoT、AI技術の効果的な活用には、これらの技術に精通した人材の育成が不可欠である。産学官連携による教育プログラムの充実や、現場技術者のリスキリング支援を強化する必要がある。また、デジタルネイティブ世代の採用と、ベテラン技術者の知識・経験のデジタル化による技術継承が重要である。"}]}}}}</script>
<script>

    const APP_DATA = JSON.parse(document.getElementById('app-data').textContent);

    const $ = sel => document.querySelector(sel);
    const $$ = sel => Array.from(document.querySelectorAll(sel));

    const state = {
      view: 'home', // 'home' | 'theme' | 'item'
      theme: null,
      sub: null, // '①' or '②'
      itemIndex: 0, // 0,1,2
      level: 1,
      strictMode: false // level4/5 exactness toggle in checks
    };

    const STORAGE_KEY = 'memo_prog_v1';

    function saveProgress(key, level){
      const prog = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
      prog[key] = Math.max(level, prog[key]||0);
      localStorage.setItem(STORAGE_KEY, JSON.stringify(prog));
    }
    function getProgress(key){
      const prog = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
      return prog[key] || 0;
    }
    function resetItemProgress(key){
      const prog = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
      delete prog[key];
      localStorage.setItem(STORAGE_KEY, JSON.stringify(prog));
    }
    function resetAll(){
      localStorage.removeItem(STORAGE_KEY);
    }

    function keyFor(theme, sub, idx){
      return `t${theme}_${sub}_${idx+1}`;
    }

    function themeList(){
      const root = $('#root');
      root.innerHTML = '';
      const container = document.createElement('div');
      container.className = 'container';
      const h = document.createElement('h2');
      h.textContent = 'テーマを選んで開始';
      h.style.margin = '12px 6px';
      h.style.fontSize = '20px';
      h.style.fontWeight = '800';
      container.appendChild(h);
      const grid = document.createElement('div');
      grid.className = 'grid themes';
      for(const [tnum, tdata] of Object.entries(APP_DATA)){
        const card = document.createElement('button');
        card.className = 'card';
        card.onclick = ()=>{
          state.view = 'theme'; state.theme = tnum; render();
        };
        const badge = document.createElement('div');
        badge.className = 'badge';
        badge.textContent = `（${"１２３４５６"[tnum-1]}）`;
        const title = document.createElement('div');
        title.className = 'title';
        title.textContent = tdata.title;
        const hint = document.createElement('div');
        hint.className = 'pill';
        hint.textContent = '①・② × 各3本';
        card.appendChild(badge);
        card.appendChild(title);
        card.appendChild(hint);
        grid.appendChild(card);
      }
      container.appendChild(grid);
      root.appendChild(container);
      footerHome();
    }

    function footerHome(){
      const foot = $('.foot');
      foot.innerHTML = '';
      const row = document.createElement('div');
      row.className = 'row';
      const btn = document.createElement('button');
      btn.className = 'btn secondary grow';
      btn.textContent = 'すべてリセット';
      btn.onclick = ()=>{ if(confirm('全テーマの進捗を消去しますか？')){ resetAll(); alert('消去しました'); render(); } };
      row.appendChild(btn);
      foot.appendChild(row);
    }

    function themeView(){
      const t = APP_DATA[state.theme];
      const root = $('#root');
      root.innerHTML = '';
      const container = document.createElement('div');
      container.className = 'container';
      const title = document.createElement('div');
      title.innerHTML = `<div class="pill">テーマ（${"１２３４５６"[state.theme-1]}）</div><h2 style="margin:6px 0 12px;font-size:20px;font-weight:800">${t.title}</h2>`;
      container.appendChild(title);

      // Subsections
      const subs = ['①','②'].filter(s=>t.subs[s]);
      for(const s of subs){
        const block = document.createElement('div');
        block.className = 'card';
        const st = document.createElement('div');
        st.className = 'title';
        st.innerHTML = `${s} ${t.subs[s].title}`;
        block.appendChild(st);

        // items
        const subgrid = document.createElement('div');
        subgrid.className = 'subgrid';
        t.subs[s].items.forEach((it, i)=>{
          const b = document.createElement('button');
          b.className = 'itembtn';
          b.onclick = ()=>{ state.view='item'; state.sub=s; state.itemIndex=i; state.level=(getProgress(keyFor(state.theme, s, i))||1); render(); };
          b.innerHTML = `<small>${s}-${i+1}</small>${it.title}<div class="levelbar">${[1,2,3,4,5].map(l=>`<span class="dot ${getProgress(keyFor(state.theme,s,i))>=l?'active':''}"></span>`).join('')}</div>`;
          subgrid.appendChild(b);
        });
        block.appendChild(subgrid);
        container.appendChild(block);
      }
      $('#root').appendChild(container);
      footerTheme();
    }

    function footerTheme(){
      const foot = $('.foot');
      foot.innerHTML='';
      const row = document.createElement('div'); row.className='row';
      const back = document.createElement('button'); back.className='btn ghost back'; back.textContent='← テーマ一覧に戻る'; back.onclick=()=>{ state.view='home'; render(); };
      row.appendChild(back);
      const reset = document.createElement('button'); reset.className='btn secondary'; reset.textContent='このテーマをリセット'; reset.onclick=()=>{
        if(confirm('このテーマ内の進捗をすべて消去しますか？')){
          const t = APP_DATA[state.theme];
          for(const s of ['①','②']){
            if(!t.subs[s]) continue;
            t.subs[s].items.forEach((_,i)=> resetItemProgress(keyFor(state.theme,s,i)));
          }
          alert('消去しました'); render();
        }
      };
      row.appendChild(reset);
      foot.appendChild(row);
    }

    function normalize(s, mode='loose'){
      if(!s) return '';
      // normalize punctuation and spaces
      s = s.replace(/[ 　	
]/g, '');
      // unify different dashes etc
      s = s.replace(/[‐‑‒–—−ー]/g, '-');
      // unify brackets
      s = s.replace(/[“”]/g,'"').replace(/[’]/g,"'");
      // Optionally remove punctuation in loose mode
      if(mode==='loose'){
        s = s.replace(/[、，。．「」『』（）()［］\[\]【】〈〉《》]/g,'');
      }
      return s;
    }

    function mask(text, level){
      if(level===1){
        let out = text;
        // mask first noun after "による"
        out = out.replace(/による([^\s「」、。]+?)/, 'による□');
        // mask '政府'
        out = out.replace(/政府/g, '□');
        // mask 'カーボンニュートラル'
        out = out.replace(/カーボンニュートラル/g, '□');
        // mask years like 20xx年
        out = out.replace(/20\d{2}年/g, '20□年');
        return out;
      }
      if(level===2){
        let out = text;
        out = out.replace(/「[^」]+」/g, '「□」');
        out = out.replace(/政府/g, '□');
        out = out.replace(/カーボンニュートラル/g, '□');
        out = out.replace(/\d/g, '□'); // mask digits
        out = out.replace(/20□年/g, '20□年'); // ensure
        return out;
      }
      if(level===3){
        return '□（本文をすべて書く）';
      }
      if(level===4){
        // keep only particles & punctuation
        return text.replace(/[^はがをにでとからまでのよりへやも、。・，．「」『』（）()：；…〜～\-\s]/g,'□');
      }
      if(level===5){
        return 'ヒントなし';
      }
      return text;
    }

    function itemView(){
      const t = APP_DATA[state.theme];
      const s = state.sub;
      const it = t.subs[s].items[state.itemIndex];
      const key = keyFor(state.theme, s, state.itemIndex);
      const progress = getProgress(key);
      const root = $('#root');
      root.innerHTML = '';
      const container = document.createElement('div'); container.className='container';

      const head = document.createElement('div');
      head.innerHTML = `<div class="toolbar"><button class="btn ghost back" onclick="state.view='theme'; render()">← ${t.title}</button><span class="pill">${s}-${state.itemIndex+1} ${it.title}</span><span class="pill">Lv.${state.level}</span></div>`;
      container.appendChild(head);

      const hint = document.createElement('div'); hint.className='hint';
      hint.textContent = mask(it.text, state.level);
      container.appendChild(hint);

      const ta = document.createElement('textarea');
      ta.id='answer';
      ta.placeholder = 'ここに本文をそのまま入力';
      container.appendChild(ta);

      const result = document.createElement('div'); result.id='result'; result.className='result'; result.style.margin='6px 2px';
      container.appendChild(result);

      $('#root').appendChild(container);
      footerItem(it, key, progress);
    }

    function footerItem(it, key, progress){
      const foot = $('.foot'); foot.innerHTML='';
      const row = document.createElement('div'); row.className='row';

      const reset = document.createElement('button'); reset.className='btn secondary'; reset.textContent='この課題をLv1にリセット';
      reset.onclick = ()=>{ if(confirm('この課題の進捗を消去しますか？')){ resetItemProgress(key); state.level=1; render(); } };
      row.appendChild(reset);

      const show = document.createElement('button'); show.className='btn secondary'; show.textContent='正解を表示';
      show.onclick = ()=>{ alert(it.text); };
      row.appendChild(show);

      const check = document.createElement('button'); check.className='btn grow'; check.textContent='答え合わせ';
      check.onclick = ()=>{
        const ans = $('#answer').value;
        const mode = (state.level>=4)? 'strict' : 'loose';
        const ok = (mode==='strict') ? (normalize(ans,'strict')===normalize(it.text,'strict')) : (normalize(ans,'loose')===normalize(it.text,'loose'));
        const r = $('#result');
        if(ok){
          r.textContent = '正解！';
          r.className='result ok';
          const nextLevel = Math.min(5, state.level+1);
          saveProgress(key, state.level);
          // advance
          if(state.level<5){
            if(confirm(`Lv.${state.level} クリア！ 次は Lv.${nextLevel} に進みますか？`)){
              state.level = nextLevel; render();
            }
          } else {
            alert('Lv.5 まで完了！お疲れさまでした。');
            render();
          }
        }else{
          r.textContent = '不正解。もう一度チャレンジ。';
          r.className='result ng';
        }
      };
      row.appendChild(check);

      foot.appendChild(row);
    }

    function render(){
      if(state.view==='home'){ themeList(); return; }
      if(state.view==='theme'){ themeView(); return; }
      if(state.view==='item'){ itemView(); return; }
    }

    document.addEventListener('DOMContentLoaded', ()=>{ render(); });
    
</script>
</body>
</html>